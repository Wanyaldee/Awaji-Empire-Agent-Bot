# 🤖 Awaji Empire Agent Bot

## 1. 概要

本プロジェクトは、Discordサーバーの管理と監視を目的とした Bot です。特に、特定のチャンネルへの不正な投稿のフィルタリングと、メンバーへの通知負荷を軽減するためのチャンネル権限管理（マスミュート）機能を自動化します。また、これらは簡単に機能追加が可能となっています。このプロジェクトはMITライセンスの下、自由にお使いいただけます。

## 2. 🌟 主要機能

Botは以下の2つの主要な監視・管理タスクを自動実行します。

| 機能 | 目的 | 動作詳細 |
| :--- | :--- | :--- |
| **コード提出フィルタリング** | 特定チャンネルの投稿内容を監視し、決められた形式以外の投稿を自動削除します。 | 8桁の英数字パターン（カービィのエアライダーのオレマシンコード形式）に**一致しない**メッセージを削除し、削除ログを管理者DMに送信します。 |
| **通知マスミュート** | 特定のチャンネル（雑談、配信コメントなど）について、`@everyone` の「メッセージ送信」権限を無効化します。 | **1. 新規作成時**: 対象チャンネルが作成された際、即座にミュートを適用しDM通知。   **2. 定期確認**: 毎日 16:00 JST にすべての対象チャンネルの設定を再チェックし、維持します。 |
| **起動・エラー通知** | Botの起動、コグのロード失敗、フィルタリング時の権限エラーなどを管理者DMに通知します。 | 共通の `send_admin_dm` 関数を通じて、Botの稼働状況をリアルタイムで確認可能。 |

## 3. 📐 プロジェクト構造

Botのコードは、高い保守性を保つため、コア、設定、機能（コグ）に分離されています。

### 3.1 Bot トークンと設定ファイルの準備

1.  **Bot トークンファイル (`token.txt`) の作成**:
    プロジェクトルートディレクトリ（`/discord_bot/`）に `token.txt` ファイルを新規作成し、Botトークンを**一行目のみ**に記述して保存します。
    
    ```
    YOUR_DISCORD_BOT_TOKEN_HERE
    ```

2.  **設定ファイル (`config.py`) の編集**:
    `config.py` を開き、以下の項目を設定してください。IDはすべて**文字列** (`""`) で囲む必要があります。
    
    * `ADMIN_USER_ID`: Botの起動ログやエラー通知を受け取る管理者（あなたの）ユーザーID。
    * `CODE_CHANNEL_ID`: フィルタリングを適用するオレマシンコードチャンネルのID。
    * `MUTE_ONLY_CHANNEL_NAMES`: 通知のみを抑制したいチャンネル名リスト（例: `["配信コメント", "メインチャンネル"]`）。
    * `READ_ONLY_MUTE_CHANNEL_NAMES`: ログ系のチャンネル名リスト（メッセージ送信の可否は既存のカテゴリ設定に依存）。

### 3.2 Bot トークンと設定ファイルの準備

1.  **Bot トークンの取得とファイル (`token.txt`) の作成**:
    **Discord Developer Portal** にてアプリケーションのBotセクションからトークンを取得し、プロジェクトルートディレクトリ（`/discord_bot/`）に `token.txt` ファイルを新規作成して、トークンを**一行目のみ**に記述して保存します。
    
    ```
    YOUR_DISCORD_BOT_TOKEN_HERE
    ```

2.  **設定ファイル (`config.py`) の準備**:
    リポジトリに含まれている `config.py.example` をコピーし、ファイル名を **`config.py`** に変更してください。
    
    ```bash
    cp config.py.example config.py
    ```

3.  **設定ファイル (`config.py`) の編集**:
    新しく作成した `config.py` を開き、以下の項目を設定してください。IDはすべて**文字列** (`""`) で囲む必要があります。
    
    * `ADMIN_USER_ID`: Botの起動ログやエラー通知を受け取る管理者（あなたの）ユーザーID。
    * `CODE_CHANNEL_ID`: フィルタリングを適用するオレマシンコードチャンネルのID。
    * `MUTE_ONLY_CHANNEL_NAMES`: 通知のみを抑制したいチャンネル名リスト。
    * `READ_ONLY_MUTE_CHANNEL_NAMES`: ログ系のチャンネル名リスト。

## 4. 運用に必要なDiscord権限 (重要)

本Botの機能が正常に動作するためには、Botに付与されたロールが以下の権限を持っている必要があります。

| 機能名 | 権限 | 適用範囲 | 理由 |
| :--- | :--- | :--- | :--- |
| **コードチャンネル フィルタ** | **メッセージの管理** | フィルタリング対象のチャンネル | 添付ファイルがないメッセージを自動削除するため。 |
| **通知抑制 (常時ミュート)** | **権限の管理** | サーバー全体 または 対象チャンネル | `@everyone` ロールのチャンネル権限を上書きするために必須。 |

---
> **🚀 開発者・運用者向け**
> 
> 本 Bot の**コード構造、詳細な機能ロジック、および運用環境**については、以下のドキュメントにすべて記載されています。
> 
> [**➡️ 詳細設計と運用ドキュメント (ARCHITECTURE.md) へ**](./docs/ARCHITECTURE.md)
---
