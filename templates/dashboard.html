<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ css_ver }}">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand"><i class="fas fa-robot"></i> Awaji Empire Agent</div>
        <div class="user-menu">
            <img src="{{ user['avatar_url'] }}" class="user-avatar">
            {{ user['name'] }}
            <a href="{{ url_for('logout') }}" class="btn btn-orange btn-sm">„É≠„Ç∞„Ç¢„Ç¶„Éà</a>
        </div>
    </nav>

    <div class="container">
        {% for cat, msg in get_flashed_messages(with_categories=true) %}
            <div class="alert alert-success">{{ msg }}</div>
        {% endfor %}

        <div class="panel">
            <div class="panel-header">
                <h2>üìú ‰ΩúÊàê„Åó„Åü„Ç¢„É≥„Ç±„Éº„Éà</h2>
                <form action="{{ url_for('survey.create_new') }}" method="post">
                    <button class="btn btn-green"><i class="fas fa-plus"></i> Êñ∞Ë¶è‰ΩúÊàê</button>
                </form>
            </div>

            <table class="responsive-table">
                <thead>
                    <tr>
                        <th style="width:60px;">ID</th> <th>„Çø„Ç§„Éà„É´</th>
                        <th style="width:100px;">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                        <th style="width:150px;">‰ΩúÊàêÊó•</th>
                        <th style="width:250px;">Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in surveys %}
                    <tr>
                        <td data-label="ID" style="font-family:monospace; font-size:1.1rem; color:#555;">
                            {{ '%03d' % s['id'] }}
                        </td>
                        
                        <td data-label="„Çø„Ç§„Éà„É´">{{ s['title'] }}</td>
                        <td data-label="„Çπ„ÉÜ„Éº„Çø„Çπ">
                            <span class="status-badge {{ 'active' if s['is_active'] else 'closed' }}">
                                {{ 'Âèó‰ªò‰∏≠' if s['is_active'] else 'ÂÅúÊ≠¢‰∏≠' }}
                            </span>
                        </td>
                        <td data-label="‰ΩúÊàêÊó•" style="color:var(--text-muted);">{{ s['created_at'] }}</td>
                        <td data-label="Êìç‰Ωú">
                            <div class="action-group">
                                <form action="{{ url_for('survey.toggle_status', survey_id=s['id']) }}" method="post" style="flex:1;">
                                    <button class="btn {{ 'btn-orange' if s['is_active'] else 'btn-green' }}">
                                        {{ 'ÂÅúÊ≠¢' if s['is_active'] else 'ÂÜçÈñã' }}
                                    </button>
                                </form>
                                <a href="{{ url_for('survey.edit_survey', survey_id=s['id']) }}" class="btn btn-blue">Á∑®ÈõÜ</a>
                                <a href="{{ url_for('survey.view_results', survey_id=s['id']) }}" class="btn btn-blue">ÈõÜË®à</a>
                                <a href="{{ url_for('survey.download_csv', survey_id=s['id']) }}" class="btn btn-gray" title="CSV"><i class="fas fa-file-csv"></i></a>
                                
                                <a href="{{ url_for('survey.view_form', survey_id=s['id']) }}" target="_blank" class="btn btn-green" title="ÂõûÁ≠î„Éö„Éº„Ç∏"><i class="fas fa-external-link-alt"></i></a>
                                <form action="{{ url_for('survey.delete_survey', survey_id=s['id']) }}" method="post" onsubmit="return confirm('ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">
                                    <button class="btn btn-gray"><i class="fas fa-trash"></i></button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" style="text-align:center; padding:30px;">„Ç¢„É≥„Ç±„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
