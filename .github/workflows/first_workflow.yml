# .github/workflows/first_workflow.yml

name: CI/CD Pipeline

# ãƒ—ãƒƒã‚·ãƒ¥ã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«å®Ÿè¡Œ
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  # ----------------------------------------------------
  # 1. build_and_test: å¾“æ¥ã®CIãƒã‚§ãƒƒã‚¯ï¼ˆãƒ“ãƒ«ãƒ‰ç¢ºèªï¼‰
  # ----------------------------------------------------
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Display environment check
        run: |
          echo "CIç’°å¢ƒã§ã®Pythonã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚"
          python --version
          # ğŸš¨ ã“ã“ã«ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’è¿½è¨˜å¯èƒ½

  # ----------------------------------------------------
  # 2. update_document: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è‡ªå‹•ç”Ÿæˆã¨ã‚³ãƒŸãƒƒãƒˆ
  # ----------------------------------------------------
  update_document:
    # build_and_testã‚¸ãƒ§ãƒ–ãŒæˆåŠŸã—ãŸå¾Œã«ã®ã¿å®Ÿè¡Œ
    needs: build_and_test
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        # ActionsãŒã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãŸã‚ã«ã€fetch-depth: 0 ã‚’æŒ‡å®š
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Generate and update ARCHITECTURE.md
        # doc_generator.py ã‚’å®Ÿè¡Œã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
        run: |
          python doc_generator.py

      - name: Commit and push updated document (è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ)
        # stefanzweifel/git-auto-commit-action ã‚’ä½¿ç”¨
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'docs: Auto update functional details via CI'
          # doc_generator.py ã®å¤‰æ›´ã‚‚è¨˜éŒ²
          file_pattern: 'doc_generator.py docs/ARCHITECTURE.md'
          # ã“ã®è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆã§ã¯CIã‚’å†ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ã‚ˆã†ã«è¨­å®š
          skip_ci: true
